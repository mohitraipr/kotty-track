<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Generate Challan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet"
        href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    body { background:#f8f9fa; }
    .form-section { background:#fff;padding:20px;border-radius:5px;
                    box-shadow:0 2px 6px rgba(0,0,0,.1); }
    .disabled-input { background:#e9ecef; }
  </style>
</head>
<body>
<div class="container">
  <div class="my-4 d-flex justify-content-between align-items-center">
    <h1>Challan Generation</h1>
  </div>

  <div class="form-section">
    <form action="/challandashboard/create" method="POST">
      <input type="hidden" name="selectedRows"
             value='<%= JSON.stringify(selectedRows) %>'>

      <div class="form-row">
        <div class="col-md-4 mb-3">
          <label for="challanDate">Challan Date</label>
          <input type="date" class="form-control" id="challanDate"
                 name="challanDate" required>
        </div>
        <div class="col-md-4 mb-3">
          <label for="washerId">Select Washer&nbsp;(Consignee)</label>
          <select class="form-control" id="washerId" name="washerId" required>
            <option value="">-- Select Washer --</option>
            <% washers.forEach(w => { %>
              <option value="<%= w.id %>"><%= w.username %></option>
            <% }) %>
          </select>
        </div>
      </div>

      <!-- Consignee auto-fill -->
      <div class="form-row">
        <div class="col-md-3 mb-3">
          <label for="consigneeName">Consignee Name</label>
          <input type="text" class="form-control disabled-input"
                 id="consigneeName" disabled>
        </div>
        <div class="col-md-3 mb-3">
          <label for="consigneeGstin">Consignee GSTIN</label>
          <input type="text" class="form-control disabled-input"
                 id="consigneeGstin" disabled>
        </div>
        <div class="col-md-4 mb-3">
          <label for="consigneeAddress">Consignee Address</label>
          <input type="text" class="form-control disabled-input"
                 id="consigneeAddress" disabled>
        </div>
        <div class="col-md-2 mb-3">
          <label for="placeOfSupply">Place of Supply</label>
          <input type="text" class="form-control disabled-input"
                 id="placeOfSupply" disabled>
        </div>
      </div>

      <!-- Vehicle number (under consignee address as requested) -->
      <div class="form-row">
        <div class="col-md-3 mb-3">
          <label for="vehicleNumber">Vehicle&nbsp;Number</label>
          <input type="text" class="form-control" id="vehicleNumber"
                 name="vehicleNumber" placeholder="HR55-AB-1234" required>
        </div>
      </div>

      <!-- Purpose & Price -->
      <div class="form-row">
        <div class="col-md-6 mb-3">
          <label for="purpose">Purpose</label>
          <input type="text" class="form-control" id="purpose"
                 name="purpose" placeholder="e.g. Washing Job Work">
        </div>
        <div class="col-md-3 mb-3">
          <label for="purposePrice">Purpose&nbsp;Price (â‚¹)</label>
          <input type="number" step="0.01" min="0"
                 class="form-control" id="purposePrice"
                 name="purposePrice" placeholder="0.00">
        </div>
      </div>

      <!-- Selected lots summary -->
      <h4 class="mt-4">Selected Lots Summary</h4>
      <div class="table-responsive">
        <table class="table table-bordered">
          <thead class="thead-light">
          <tr>
            <th>Lot No</th><th>SKU</th><th>Total Pieces</th><th>Cutting Remark</th>
          </tr></thead>
          <tbody>
          <% selectedRows.forEach(r=>{ %>
            <tr>
              <td><%= r.lot_no %></td>
              <td><%= r.sku %></td>
              <td><%= r.total_pieces %></td>
              <td><%= r.cutting_remark || '' %></td>
            </tr>
          <% }) %>
          </tbody>
        </table>
      </div>

      <div class="mt-4 text-right">
        <button type="submit" class="btn btn-primary">
          Confirm&nbsp;&amp;&nbsp;Generate Challan
        </button>
      </div>
    </form>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
  const consigneeMapping = { /* same JS object you already had */ };

  $('#washerId').on('change', function () {
    const d = consigneeMapping[this.value] || {};
    $('#consigneeName').val(d.name || '');
    $('#consigneeGstin').val(d.gstin || '');
    $('#consigneeAddress').val(d.address || '');
    $('#placeOfSupply').val(d.placeOfSupply || '');
  });
</script>
</body>
</html>
